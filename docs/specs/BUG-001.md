# BUG-001: Scripted Skill Prompts Use Wrong Script Path

| Field       | Value |
|-------------|-------|
| ID          | BUG-001 |
| Type        | Bug |
| Priority    | P1 |
| Status      | Open |
| Release     | 1.1.1 |
| Created     | 2025-02-13 |

## Summary

The SKILL.md prompt templates for the 3 scripted skills (`pactkit-visualize`, `pactkit-board`, `pactkit-scaffold`) reference scripts with bare relative paths like `python3 scripts/visualize.py`. When Claude Code invokes these skills, it provides `Base directory for this skill: /path/to/skill` as context, but the LLM executes bash commands from the project's working directory — not the skill directory. This makes the scripts unreachable.

## Observed Behavior

1. User runs `/pactkit-visualize`
2. Claude Code shows: `Base directory for this skill: /Users/slim/.claude/skills/pactkit-visualize`
3. SKILL.md instructs: `python3 scripts/visualize.py visualize`
4. Claude runs the command from project cwd → `scripts/visualize.py` not found
5. Claude falls back to globbing the project, finds `src/pactkit/skills/visualize.py` (source code in dev repo) and runs that instead
6. For end-users (non-dev), step 5 would simply fail — no fallback exists

## Expected Behavior

The skill prompt MUST guide Claude to invoke the script using its deployed absolute path, derived from the base directory provided in the skill invocation header.

## Root Cause

`SKILL_VISUALIZE_MD`, `SKILL_BOARD_MD`, and `SKILL_SCAFFOLD_MD` in `src/pactkit/prompts/skills.py` all use `python3 scripts/{name}.py` without anchoring to the skill's base directory.

## Target Call Chain

```
User → /pactkit-visualize
  → Claude Code reads ~/.claude/skills/pactkit-visualize/SKILL.md
  → Provides "Base directory for this skill: {path}" header
  → LLM reads SKILL.md prompt → finds script path instruction
  → LLM runs Bash(python3 {path}/scripts/visualize.py ...)  ← FIX HERE
```

## Requirements

- R1: All scripted skill SKILL.md templates MUST include a note instructing the LLM to resolve script paths relative to the skill's base directory (provided in the invocation header).
- R2: The path pattern MUST work for classic deployment (`~/.claude/skills/{name}/scripts/{script}`).
- R3: The path pattern SHOULD also work for plugin deployment by using the base directory variable from the invocation header rather than hardcoding `~/.claude/`.
- R4: The fix MUST NOT change the script files themselves — only the SKILL.md prompt templates in `src/pactkit/prompts/skills.py`.
- R5: Existing tests MUST continue to pass.

## Acceptance Criteria

### Scenario 1: Classic deployment path resolution
- **Given** PactKit is deployed via `pactkit init` (classic mode)
- **When** a user invokes `/pactkit-visualize`
- **Then** the SKILL.md prompt contains a path instruction that resolves to `~/.claude/skills/pactkit-visualize/scripts/visualize.py`

### Scenario 2: All 3 scripted skills are fixed
- **Given** the fix is applied
- **When** inspecting `SKILL_VISUALIZE_MD`, `SKILL_BOARD_MD`, and `SKILL_SCAFFOLD_MD`
- **Then** all 3 templates reference scripts using the base directory pattern, not bare `scripts/` paths

### Scenario 3: Prompt text includes base directory instruction
- **Given** the deployed SKILL.md for any scripted skill
- **When** the LLM reads the prompt
- **Then** the prompt explicitly instructs the LLM to use the base directory from the invocation header to construct the script path

## Affected Files

| File | Change |
|------|--------|
| `src/pactkit/prompts/skills.py` | Update `SKILL_VISUALIZE_MD`, `SKILL_BOARD_MD`, `SKILL_SCAFFOLD_MD` path references |
